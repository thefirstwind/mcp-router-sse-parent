# Nacos 和 MCP Server 管理 UI 设计计划

## 一、功能分析

### 1.1 Nacos 集成功能
- **服务注册/注销**：MCP Server 注册到 Nacos，支持手动注册和自动注册
- **服务发现**：从 Nacos 获取健康实例列表，支持按服务名、服务组查询
- **服务订阅**：监听 Nacos 服务变更事件，实时更新本地缓存
- **配置管理**：
  - 服务器配置（Server Config）
  - 工具配置（Tools Config）
  - 版本配置（Version Config）
- **元数据管理**：服务实例的元数据（版本、工具列表、能力等）

### 1.2 MCP Server 管理功能
- **服务列表**：展示所有已注册的 MCP Server
- **实例管理**：查看服务的所有实例（健康/不健康）
- **健康检查**：
  - 健康状态监控
  - 健康检查统计（成功率、失败率、平均响应时间）
  - 手动触发健康检查
- **负载均衡**：查看负载均衡策略和权重分配
- **熔断器**：查看熔断器状态（开启/关闭/半开）
- **服务配置**：
  - 查看服务器配置详情
  - 查看工具配置详情
  - 查看版本历史
  - 发布/更新配置

### 1.3 现有 API 端点
```
GET  /api/mcp/servers                    # 获取所有 MCP 服务器
GET  /api/mcp/servers/group/{group}      # 按组获取服务器
GET  /api/mcp/servers/instances           # 获取所有实例
GET  /api/mcp/servers/select              # 选择健康实例
POST /api/mcp/servers/register            # 注册服务器
DELETE /api/mcp/servers/deregister        # 注销服务器
GET  /api/mcp/servers/config/{id}        # 获取服务器配置
GET  /api/mcp/servers/config/full/{id}   # 获取完整配置
GET  /api/mcp/servers/config/versions/{id} # 获取版本列表
POST /api/mcp/servers/config/publish      # 发布服务器配置
POST /api/mcp/servers/config/tools/publish # 发布工具配置
POST /api/mcp/servers/config/version/publish # 发布版本配置
GET  /mcp/health/status                   # 获取所有健康状态
GET  /mcp/health/status/{serviceName}    # 获取指定服务健康状态
GET  /mcp/health/circuit-breakers        # 获取所有熔断器状态
GET  /mcp/health/circuit-breakers/{serviceName} # 获取指定服务熔断器状态
POST /mcp/health/check/{serviceName}     # 触发健康检查
POST /mcp/health/check/all               # 触发全量健康检查
```

## 二、UI 页面设计

### 2.1 页面结构
在现有的 Admin Dashboard 中新增两个 Tab：
1. **服务注册中心**（Service Registry）
2. **健康监控**（Health Monitor）

### 2.2 Tab 1: 服务注册中心（Service Registry）

#### 2.2.1 页面布局
```
┌─────────────────────────────────────────────────────────┐
│  服务注册中心                                            │
├─────────────────────────────────────────────────────────┤
│  [筛选器] 服务组: [下拉] 服务名: [输入] [搜索] [刷新]   │
├─────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────┐ │
│  │  服务列表（卡片式）                                 │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐          │ │
│  │  │ Server 1 │ │ Server 2 │ │ Server 3 │          │ │
│  │  └──────────┘ └──────────┘ └──────────┘          │ │
│  └───────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  [服务详情面板]（右侧或底部）                           │
│  - 基本信息                                             │
│  - 实例列表                                             │
│  - 配置信息                                             │
│  - 工具列表                                             │
└─────────────────────────────────────────────────────────┘
```

#### 2.2.2 服务卡片设计
每个服务卡片显示：
- **服务名称**（大标题）
- **服务组**（标签）
- **版本号**（标签）
- **实例数量**（健康/总数）
- **健康状态**（绿色/红色圆点）
- **最后更新时间**
- **操作按钮**：查看详情、注销服务

#### 2.2.3 服务详情面板
- **基本信息**：
  - 服务名称、版本、服务组
  - IP、端口、权重
  - 注册时间、最后心跳时间
  - 元数据（JSON 展示）
- **实例列表**（表格）：
  - IP:Port
  - 健康状态
  - 权重
  - 是否启用
  - 最后更新时间
- **配置信息**（Tab 切换）：
  - **服务器配置**：JSON 格式展示，支持查看不同版本
  - **工具配置**：工具列表，每个工具显示名称、描述、参数
  - **版本历史**：版本列表，支持切换版本查看
- **工具列表**：
  - 工具名称、描述
  - 参数列表
  - 能力标签

#### 2.2.4 功能按钮
- **注册服务**：弹出表单，输入服务信息进行注册
- **刷新列表**：重新从 Nacos 获取服务列表
- **导出配置**：导出选中服务的配置为 JSON

### 2.3 Tab 2: 健康监控（Health Monitor）

#### 2.3.1 页面布局
```
┌─────────────────────────────────────────────────────────┐
│  健康监控                                                │
├─────────────────────────────────────────────────────────┤
│  [统计卡片] 总服务数 | 健康服务 | 不健康服务 | 熔断服务 │
├─────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────┐ │
│  │  服务健康状态列表（表格）                           │ │
│  │  服务名 | 健康状态 | 最后检查 | 成功率 | 操作      │ │
│  └───────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│  [健康检查详情面板]（右侧或底部）                       │
│  - 健康状态详情                                         │
│  - 检查历史                                             │
│  - 熔断器状态                                           │
└─────────────────────────────────────────────────────────┘
```

#### 2.3.2 统计卡片
- **总服务数**：所有已注册的服务数量
- **健康服务**：健康状态为 true 的服务数量
- **不健康服务**：健康状态为 false 的服务数量
- **熔断服务**：熔断器状态为 OPEN 的服务数量

#### 2.3.3 健康状态表格
列：
- **服务名称**
- **健康状态**（图标 + 文字）
- **最后检查时间**
- **成功次数**
- **失败次数**
- **成功率**（百分比）
- **平均响应时间**（ms）
- **熔断器状态**（CLOSED/OPEN/HALF_OPEN）
- **操作**：查看详情、手动检查、重置熔断器

#### 2.3.4 健康检查详情面板
- **健康状态详情**：
  - 当前健康状态
  - 服务器 ID
  - 连续失败次数
  - 最后检查时间
  - 检查间隔
- **检查历史**（时间线）：
  - 最近 10 次检查结果
  - 时间、状态、响应时间
- **熔断器状态**：
  - 当前状态（CLOSED/OPEN/HALF_OPEN）
  - 失败阈值
  - 半开状态尝试次数
  - 最后状态变更时间

#### 2.3.5 功能按钮
- **全量健康检查**：触发所有服务的健康检查
- **刷新状态**：重新获取健康状态
- **导出报告**：导出健康检查报告

## 三、技术实现计划

### 3.1 前端实现
1. **新增 Tab**：
   - 在 `index.html` 的 tab 导航中添加两个新 tab
   - 添加对应的 tab-content 区域

2. **服务注册中心页面**：
   - 服务列表：使用卡片式布局，响应式设计
   - 服务详情：使用侧边栏或模态框展示
   - 配置查看：使用 JSON 高亮显示
   - 工具列表：使用表格或卡片展示

3. **健康监控页面**：
   - 统计卡片：使用现有的 stat-card 样式
   - 健康状态表格：使用现有的 table 样式
   - 详情面板：使用现有的 card 样式
   - 时间线：使用现有的 timeline 样式

4. **API 调用**：
   - 使用 `fetchJson` 函数调用后端 API
   - 实现轮询刷新（每 30 秒）
   - 错误处理和加载状态

### 3.2 后端 API 扩展（如需要）
- 如果需要聚合数据，可以新增聚合 API
- 如果需要批量操作，可以新增批量 API

### 3.3 样式设计
- 复用现有的 CSS 变量和样式
- 服务卡片使用渐变背景（类似协议卡片）
- 健康状态使用颜色编码（绿色=健康，红色=不健康，黄色=警告）
- 响应式设计，支持移动端

## 四、实施步骤

### Phase 1: 服务注册中心基础功能
1. ✅ 添加 "服务注册中心" Tab
2. ✅ 实现服务列表展示（卡片式）
3. ✅ 实现服务筛选功能
4. ✅ 实现服务详情面板
5. ✅ 实现配置查看功能

### Phase 2: 服务注册中心高级功能
1. ✅ 实现服务注册表单
2. ✅ 实现服务注销功能
3. ✅ 实现工具列表展示
4. ✅ 实现版本切换功能
5. ✅ 实现配置导出功能

### Phase 3: 健康监控基础功能
1. ✅ 添加 "健康监控" Tab
2. ✅ 实现统计卡片
3. ✅ 实现健康状态表格
4. ✅ 实现健康检查详情面板

### Phase 4: 健康监控高级功能
1. ✅ 实现检查历史时间线
2. ✅ 实现熔断器状态展示
3. ✅ 实现手动触发健康检查
4. ✅ 实现全量健康检查
5. ✅ 实现健康检查报告导出

### Phase 5: 优化和测试
1. ✅ 性能优化（缓存、防抖）
2. ✅ 错误处理完善
3. ✅ 用户体验优化
4. ✅ 响应式设计优化
5. ✅ 测试和修复

## 五、UI 设计细节

### 5.1 服务卡片样式
```css
.service-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    padding: 20px;
    color: white;
    box-shadow: var(--shadow-lg);
    transition: transform 0.2s;
}
.service-card:hover {
    transform: translateY(-2px);
}
```

### 5.2 健康状态颜色
- **健康**：`#10b981` (绿色)
- **不健康**：`#ef4444` (红色)
- **警告**：`#f59e0b` (黄色)
- **未知**：`#6b7280` (灰色)

### 5.3 熔断器状态
- **CLOSED**：绿色，正常状态
- **OPEN**：红色，熔断开启
- **HALF_OPEN**：黄色，半开状态

### 5.4 响应式断点
- 桌面端：`> 1024px`，两列布局
- 平板端：`768px - 1024px`，单列布局
- 移动端：`< 768px`，单列布局，卡片堆叠

## 六、数据流设计

### 6.1 服务注册中心数据流
```
用户操作 → 前端 API 调用 → 后端 Controller → Service → Registry → Nacos
                ↓
        前端更新 UI ← JSON 响应 ←
```

### 6.2 健康监控数据流
```
定时轮询/手动触发 → 前端 API 调用 → HealthCheckService → 返回状态
                ↓
        前端更新 UI ← JSON 响应 ←
```

## 七、注意事项

1. **性能考虑**：
   - 服务列表使用分页或虚拟滚动（如果服务数量很多）
   - 健康检查使用轮询，但需要控制频率
   - 配置查看使用懒加载

2. **错误处理**：
   - Nacos 未启用时的降级处理
   - 网络错误的重试机制
   - 友好的错误提示

3. **用户体验**：
   - 加载状态提示
   - 操作确认（注销服务等危险操作）
   - 成功/失败提示
   - 快捷键支持（刷新等）

4. **数据一致性**：
   - 服务列表和健康状态需要同步
   - 配置变更后需要刷新相关数据
   - 使用时间戳判断数据新鲜度

## 八、后续扩展

1. **服务分组管理**：支持自定义服务分组
2. **配置版本对比**：对比不同版本的配置差异
3. **服务依赖关系**：展示服务之间的依赖关系图
4. **性能监控**：集成性能指标（QPS、延迟等）
5. **告警功能**：健康检查失败时发送告警
6. **操作日志**：记录服务注册/注销等操作历史











