# MCP Router v3 UI 改进方案 V3

## 📋 设计目标

创建一个**更直观、更专业**的 UI 界面，突出展示 MCP 标准协议特点，让 RESTful 请求、SSE 连接、MCP Streamable 连接等更加清晰易懂。

## 🎯 核心设计理念

### 1. 协议可视化对比 ⭐⭐⭐
- **并排展示**三种协议的特点和差异
- **流程图**展示每种协议的工作流程
- **实时状态**显示当前连接和请求情况
- **标准协议标识**：清晰标识 JSON-RPC 2.0、SSE、NDJSON 等标准

### 2. 标准协议特点突出 ⭐⭐⭐
- **JSON-RPC 2.0** 格式高亮显示和结构说明
- **MCP 标准方法**分类展示（tools, resources, prompts）
- **传输层协议**清晰标识（HTTP, SSE, NDJSON）
- **端点信息**：显示各协议的端点路径和参数

### 3. 实时监控与追踪 ⭐⭐
- **连接状态**实时更新（SSE、Streamable）
- **消息流**实时展示（JSON-RPC 消息）
- **性能指标**可视化（响应时间、成功率）
- **错误追踪**：清晰的错误信息展示

## 🎨 主要功能模块

### 模块 1: 协议概览面板（新增）

#### 设计布局
```
┌─────────────────────────────────────────────────────────────┐
│  MCP Router v3 - 标准协议监控面板                           │
│  JSON-RPC 2.0 | SSE | Streamable (NDJSON) | RESTful        │
└─────────────────────────────────────────────────────────────┘

┌──────────────────┬──────────────────┬──────────────────┐
│  RESTful         │  SSE             │  Streamable      │
│  ┌────────────┐  │  ┌────────────┐  │  ┌────────────┐  │
│  │ POST       │  │  │ GET        │  │  │ GET        │  │
│  │ /route     │  │  │ /sse/{svc} │  │  │ /mcp/{svc} │  │
│  └────────────┘  │  └────────────┘  │  └────────────┘  │
│                  │                  │                  │
│  同步响应        │  事件流          │  NDJSON流        │
│  无状态          │  长连接          │  流式响应        │
│  无需会话        │  心跳: 30s      │  实时流          │
│                  │                  │                  │
│  Content-Type:   │  Content-Type:   │  Content-Type:   │
│  application/json│  text/event-stream│  application/    │
│                  │                  │  x-ndjson        │
└──────────────────┴──────────────────┴──────────────────┘
```

#### 功能特点
- **协议卡片**：每种协议独立卡片，颜色区分
  - RESTful: 蓝色 (#2563eb)
  - SSE: 绿色 (#10b981)
  - Streamable: 紫色 (#8b5cf6)
- **实时统计**：显示每种协议的活跃连接数、请求数
- **协议流程图**：SVG 或 Canvas 绘制，展示数据流动
- **端点信息**：点击查看详细的端点说明和示例

### 模块 2: JSON-RPC 2.0 格式展示（增强）

#### 格式说明卡片
```
┌─────────────────────────────────────────────────────────┐
│  JSON-RPC 2.0 标准格式                                  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  {                                                       │
│    "jsonrpc": "2.0",        ← 协议版本（必需）          │
│    "method": "tools/call",   ← MCP 方法（必需）          │
│    "id": "req-001",          ← 请求 ID（必需）           │
│    "params": {              ← 参数（可选）              │
│      "name": "getPersonById",                            │
│      "arguments": { "id": 1 }                            │
│    }                                                      │
│  }                                                       │
│                                                          │
│  MCP 标准方法分类：                                       │
│  • tools/list, tools/call                                │
│  • resources/list, resources/read                        │
│  • prompts/list, prompts/get                            │
│  • initialize                                            │
└─────────────────────────────────────────────────────────┘
```

#### 功能特点
- **语法高亮**：使用颜色区分 JSON 键、字符串、数字、布尔值
- **结构说明**：每个字段都有说明和是否必需标识
- **实时示例**：显示实际的消息结构
- **方法分类**：按 tools、resources、prompts 分类展示

### 模块 3: SSE 连接监控（增强）

#### 连接列表增强
- **连接状态指示器**：
  - 🟢 已连接（绿色圆点 + 动画）
  - 🔴 已断开（红色圆点）
  - 🟡 心跳中（黄色闪烁）
- **协议标识**：显示 "SSE" 标签
- **心跳监控**：显示最后心跳时间、心跳间隔
- **消息计数**：显示该连接的消息数量
- **实时更新**：连接状态实时刷新

#### 连接详情增强
- **协议信息**：显示 Content-Type、端点、心跳间隔
- **消息流实时展示**：实时显示接收到的 SSE 事件
- **消息格式**：展示 JSON-RPC 格式的消息内容
- **时间线视图**：按时间顺序显示所有消息

### 模块 4: Streamable 连接监控（新增）

#### 连接列表
- **连接状态**：显示 Streamable 连接状态
- **协议标识**：显示 "Streamable (NDJSON)" 标签
- **流状态**：显示流是否活跃、消息数量
- **端点信息**：显示 `/mcp/{serviceName}` 端点

#### 连接详情
- **NDJSON 流展示**：实时显示接收到的 NDJSON 消息
- **消息分隔符**：清晰标识每条消息（换行符分隔）
- **流状态监控**：显示流的开启/关闭状态
- **消息格式**：展示 JSON-RPC 格式的消息内容

### 模块 5: RESTful 请求分析（增强）

#### 请求列表增强
- **协议标识**：显示 "RESTful" 标签
- **JSON-RPC 方法**：突出显示 MCP 方法（tools/call, tools/list 等）
- **工具名称**：优先显示工具名称（如果有）
- **状态码可视化**：
  - 2xx: 绿色
  - 4xx: 橙色
  - 5xx: 红色
- **性能指标**：响应时间、服务名称

#### 请求详情增强
- **完整 JSON-RPC 格式**：清晰展示请求和响应的 JSON-RPC 2.0 格式
- **语法高亮**：代码块使用深色主题，JSON 语法高亮
- **方法分类标识**：显示方法所属分类（tools/resources/prompts）
- **标准协议说明**：显示该请求使用的协议标准

### 模块 6: 消息流追踪（增强）

#### 时间线视图
- **消息类型标识**：
  - 🔵 请求（蓝色）
  - 🟢 响应（绿色）
  - 🔴 错误（红色）
  - 🟡 心跳（黄色）
- **协议标识**：显示消息使用的协议（RESTful/SSE/Streamable）
- **JSON-RPC 格式**：每条消息都显示完整的 JSON-RPC 2.0 格式
- **关联信息**：Session ID、服务名称、响应时间

## 🎨 UI/UX 设计改进

### 1. 视觉设计
- **现代化卡片设计**：使用卡片式布局，清晰的视觉层次
- **颜色系统**：
  - Primary: #2563eb (蓝色) - RESTful
  - Success: #10b981 (绿色) - SSE
  - Purple: #8b5cf6 (紫色) - Streamable
  - Error: #ef4444 (红色) - 错误
  - Warning: #f59e0b (橙色) - 警告
- **协议标识徽章**：每种协议都有独特的颜色徽章
- **状态指示器**：使用动画和颜色表示状态

### 2. 交互设计
- **实时更新**：每 5-10 秒自动刷新（可配置）
- **点击交互**：点击列表项查看详情，点击协议卡片查看说明
- **筛选功能**：支持多维度筛选（协议类型、服务名称、时间范围等）
- **搜索功能**：支持全文搜索（Session ID、Request ID、方法名等）
- **加载状态**：显示加载动画和空状态提示

### 3. 响应式设计
- **桌面端**：充分利用空间，多列布局
- **平板端**：自适应布局，保持功能完整
- **移动端**：单列布局，优化触摸交互

## 🔧 技术实现

### 前端技术栈
- **HTML5 + CSS3**：现代化的页面结构和样式
- **原生 JavaScript**：轻量级的交互逻辑（无框架依赖）
- **CSS Grid + Flexbox**：灵活的布局系统
- **CSS Variables**：统一的颜色和样式管理

### 关键功能实现

#### 1. JSON-RPC 语法高亮
```javascript
function highlightJsonRpc(json) {
    // 使用正则表达式和 DOM 操作实现语法高亮
    // 区分：键、字符串、数字、布尔值、null
}
```

#### 2. 实时数据更新
```javascript
// 使用轮询方式更新数据
setInterval(() => {
    updateConnections();
    updateRequests();
    updateStatistics();
}, 10000); // 每 10 秒更新一次
```

#### 3. 协议流程图
```html
<!-- 使用 SVG 绘制流程图 -->
<svg class="protocol-flow">
    <path d="M 0,50 L 100,50" stroke="#2563eb" />
    <circle cx="50" cy="50" r="5" fill="#2563eb" />
    <text x="50" y="70">Client</text>
</svg>
```

## 📊 数据展示优化

### 统计卡片增强
- **协议统计**：分别显示 RESTful、SSE、Streamable 的统计
- **实时指标**：
  - 活跃连接数（SSE + Streamable）
  - 总请求数（RESTful）
  - 成功率
  - 平均响应时间
- **趋势指示**：显示指标的变化趋势（↑↓）

### 列表展示优化
- **协议筛选**：可以按协议类型筛选
- **状态筛选**：可以按连接状态筛选
- **时间筛选**：可以按时间范围筛选
- **排序功能**：支持按时间、状态、服务名称排序

### 详情展示优化
- **标签页切换**：请求详情、响应详情、元数据
- **JSON 格式化**：自动格式化 JSON，支持折叠/展开
- **复制功能**：一键复制 JSON 内容
- **导出功能**：导出为 JSON 文件

## 🚀 实施计划

### 阶段 1: 协议概览页面（优先级：高）
- [ ] 创建协议对比卡片
- [ ] 实现协议流程图
- [ ] 添加 JSON-RPC 2.0 格式说明
- [ ] 实现实时统计更新

### 阶段 2: SSE 连接监控增强（优先级：高）
- [ ] 增强连接状态指示器
- [ ] 添加心跳监控显示
- [ ] 实现消息流实时展示
- [ ] 优化连接详情页面

### 阶段 3: Streamable 连接监控（优先级：中）
- [ ] 创建 Streamable 连接列表
- [ ] 实现 NDJSON 流展示
- [ ] 添加流状态监控
- [ ] 实现连接详情页面

### 阶段 4: RESTful 请求分析增强（优先级：中）
- [ ] 增强请求列表显示
- [ ] 优化 JSON-RPC 格式展示
- [ ] 添加方法分类标识
- [ ] 实现标准协议说明

### 阶段 5: 消息流追踪增强（优先级：低）
- [ ] 增强时间线视图
- [ ] 添加协议标识
- [ ] 优化消息格式展示
- [ ] 实现消息搜索功能

## 📝 文件变更

### 新增文件
- `src/main/resources/static/admin/index-v3.html` - 新版本 UI 界面
- `docs/UI_IMPROVEMENT_V3_PLAN.md` - 本文档

### 修改文件
- `src/main/java/com/pajk/mcpbridge/core/controller/AdminDashboardController.java` - 添加 Streamable 连接 API

### API 扩展
- `GET /admin/api/streamable-connections` - 获取 Streamable 连接列表
- `GET /admin/api/protocol-stats` - 获取协议统计信息

## 🎉 预期效果

通过这个改进方案，UI 将能够：

1. ✅ **清晰展示三种协议**：RESTful、SSE、Streamable 的特点和差异
2. ✅ **突出标准协议**：JSON-RPC 2.0 格式、MCP 方法分类
3. ✅ **实时监控**：连接状态、消息流、性能指标
4. ✅ **更好的用户体验**：现代化设计、直观的交互、实时更新
5. ✅ **易于理解**：清晰的协议说明、流程图、示例

这个 UI 将使得 MCP Router v3 成为一个**专业的 MCP 标准协议管理和监控工具**。

---

**创建日期**: 2025-01-12  
**版本**: v3.0
















