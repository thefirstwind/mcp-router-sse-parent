# é¡¹ç›®æ¶æ„

> MCP Router é¡¹ç›®çš„æ•´ä½“æ¶æ„è®¾è®¡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨åº”ç”¨/ç”¨æˆ·                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ HTTP/REST
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               MCP Client (ç«¯å£ 8080)                      â”‚
â”‚  - Spring AI ChatClient                                 â”‚
â”‚  - DeepSeek Integration                                 â”‚
â”‚  - RESTful API                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ SSE (Server-Sent Events)
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             MCP Router (ç«¯å£ 8000)                        â”‚
â”‚  - Nacos Service Discovery                             â”‚
 â”‚  - Server Registry                                      â”‚
â”‚  - Load Balancing                                       â”‚
â”‚  - Health Monitoring                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Service Discovery
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nacos Server                          â”‚
â”‚  - Service Registration                                    â”‚
â”‚  - Configuration Management                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Register/Discover
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MCP Servers (å¤šå®ä¾‹)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ MCP Server v6    â”‚  â”‚ MCP Server v4    â”‚             â”‚
â”‚  â”‚ Port: 8060       â”‚  â”‚ Port: 8040       â”‚  ...        â”‚
â”‚  â”‚ Tools: @Tool     â”‚  â”‚ Tools: @Tool     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—

### 1. MCP Router (è·¯ç”±å™¨)

**èŒè´£**:
- ğŸ” æœåŠ¡å‘ç°å’Œæ³¨å†Œ
- ğŸ”„ è´Ÿè½½å‡è¡¡
- ğŸ’“ å¥åº·æ£€æŸ¥
- ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

**æŠ€æœ¯æ ˆ**:
- Spring Boot 3.2.5
- Spring WebFlux
- Nacos Client
- Spring AI MCP

**å…³é”®ç‰¹æ€§**:
- åŠ¨æ€æœåŠ¡å‘ç°
- è‡ªåŠ¨æ•…éšœè½¬ç§»
- ä¼šè¯æŒä¹…åŒ–
- RESTful API

### 2. MCP Server (å·¥å…·æœåŠ¡å™¨)

**èŒè´£**:
- ğŸ› ï¸ æä¾›å·¥å…·(Tools)
- ğŸ’¾ æ•°æ®è®¿é—®
- ğŸ” è®¤è¯æˆæƒ
- ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

**æŠ€æœ¯æ ˆ**:
- Spring Boot
- Spring AI
- MyBatis
- MySQL/H2

**å…³é”®ç‰¹æ€§**:
- `@Tool` æ³¨è§£æ”¯æŒ
- è‡ªåŠ¨toolå‘ç°
- æ”¯æŒå¤šå®ä¾‹
- çƒ­é‡è½½é…ç½®

### 3. MCP Client (å®¢æˆ·ç«¯)

**èŒè´£**:
- ğŸ¤– AI å¯¹è¯æ¥å£
- ğŸ”Œ è¿æ¥ MCP Server
- ğŸ“ è¯·æ±‚ç¼–æ’
- ğŸ“Š ç»“æœèšåˆ

**æŠ€æœ¯æ ˆ**:
- Spring Boot
- Spring AI ChatClient
- DeepSeek AI
- WebFlux

**å…³é”®ç‰¹æ€§**:
- è‡ªç„¶è¯­è¨€æ¥å£
- Toolè°ƒç”¨ç¼–æ’
- æµå¼å“åº”(SSE)
- ç¼“å­˜ä¼˜åŒ–

---

## ğŸ”„ æ•°æ®æµ

### 1. ç”¨æˆ·è¯·æ±‚æµç¨‹

```
1. ç”¨æˆ·å‘é€ HTTP è¯·æ±‚
   â†“
2. MCP Client æ¥æ”¶è¯·æ±‚
   â”œâ”€ è§£æç”¨æˆ·æ„å›¾
   â””â”€ æ„é€  AI Prompt
   â†“
3. Spring AI ChatClient å¤„ç†
   â”œâ”€ è°ƒç”¨ DeepSeek API
   â””â”€ è¯†åˆ«éœ€è¦çš„ Tools
   â†“
4. é€šè¿‡ SSE è¿æ¥ MCP Server
   â”œâ”€ MCP Router è·¯ç”±è¯·æ±‚
   â””â”€ è´Ÿè½½å‡è¡¡åˆ°å…·ä½“Server
   â†“
5. MCP Server æ‰§è¡Œ Tool
   â”œâ”€ è°ƒç”¨ä¸šåŠ¡é€»è¾‘
   â””â”€ è®¿é—®æ•°æ®åº“
   â†“
6. è¿”å›ç»“æœ
   â”œâ”€ Tool ç»“æœ â†’ AI
   â”œâ”€ AI ç”Ÿæˆå›ç­”
   â””â”€ è¿”å›ç»™ç”¨æˆ·
```

### 2. æœåŠ¡æ³¨å†Œæµç¨‹

```
1. MCP Server å¯åŠ¨
   â†“
2. å‘ Nacos æ³¨å†Œ
   â”œâ”€ æœåŠ¡åç§°
   â”œâ”€ IPå’Œç«¯å£
   â”œâ”€ å…ƒæ•°æ®(Toolsåˆ—è¡¨)
   â””â”€ å¥åº·æ£€æŸ¥ç«¯ç‚¹
   â†“
3. Nacos å­˜å‚¨æœåŠ¡ä¿¡æ¯
   â†“
4. MCP Router è®¢é˜…å˜æ›´
   â”œâ”€ æ¥æ”¶æ–°æœåŠ¡é€šçŸ¥
   â””â”€ æ›´æ–°è·¯ç”±è¡¨
   â†“
5. å®šæœŸå¥åº·æ£€æŸ¥
   â””â”€ è‡ªåŠ¨æ‘˜é™¤ä¸å¥åº·å®ä¾‹
```

---

## ğŸ”‘ å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆé€‰æ‹© Nacosï¼Ÿ

**ä¼˜åŠ¿**:
- âœ… æœåŠ¡å‘ç° + é…ç½®ç®¡ç†
- âœ… å¤šæ•°æ®ä¸­å¿ƒæ”¯æŒ
- âœ… å¥åº·æ£€æŸ¥å†…ç½®
- âœ… é˜¿é‡Œäº‘ç”Ÿæ€é›†æˆå¥½

**æ›¿ä»£æ–¹æ¡ˆ**: Eureka, Consul, Zookeeper

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨ SSE è€Œé WebSocketï¼Ÿ

**SSE ä¼˜åŠ¿**:
- âœ… å•å‘é€šä¿¡è¶³å¤Ÿ(Server â†’ Client)
- âœ… è‡ªåŠ¨é‡è¿
- âœ… æ›´ç®€å•çš„åè®®
- âœ… HTTP/2 æ”¯æŒ

**é€‚ç”¨åœºæ™¯**: å®æ—¶æ¨é€ã€æ—¥å¿—æµã€è¿›åº¦æ›´æ–°

### 3. ä¸ºä»€ä¹ˆå¤šæ¨¡å—æ¶æ„ï¼Ÿ

**ä¼˜åŠ¿**:
- âœ… å…³æ³¨ç‚¹åˆ†ç¦»
- âœ… ç‹¬ç«‹éƒ¨ç½²
- âœ… æŠ€æœ¯æ ˆçµæ´»
- âœ… å›¢é˜Ÿåä½œå‹å¥½

---

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### 1. ç¼“å­˜ç­–ç•¥

```java
// MCP Client ç¼“å­˜ Tool åˆ—è¡¨
@Cacheable(value = "tools", key = "#serverId")
public List<Tool> getToolsByServerId(String serverId)

// MCP Router ç¼“å­˜æœåŠ¡ä¿¡æ¯
@Cacheable(value = "services", ttl = 30s)
public List<ServiceInstance> getHealthyInstances()
```

### 2. è¿æ¥æ± 

```yaml
# WebClient è¿æ¥æ± é…ç½®
spring:
  webflux:
    client:
      pool:
        max-connections: 500
        max-idle-time: 20s
```

### 3. è´Ÿè½½å‡è¡¡

- **ç®—æ³•**: Round Robin (é»˜è®¤)
- **å¥åº·æ£€æŸ¥**: æ¯ 5 ç§’
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨åˆ‡æ¢åˆ°å¥åº·å®ä¾‹

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. è®¤è¯æ–¹å¼

- API Key (DeepSeek)
- JWT Token (ä¼ä¸šç‰ˆ)
- OAuth2 (å¯é€‰)

### 2. æ•°æ®å®‰å…¨

- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- TLS/SSL ä¼ è¾“åŠ å¯†
- æ—¥å¿—è„±æ•

### 3. é™æµä¿æŠ¤

```yaml
# é™æµé…ç½®
rate-limit:
  enabled: true
  requests-per-second: 100
  burst-capacity: 200
```

---

## ğŸš€ æ‰©å±•æ€§

### æ°´å¹³æ‰©å±•

```bash
# å¯åŠ¨å¤šä¸ª MCP Server å®ä¾‹
./start-server.sh --port 8060
./start-server.sh --port 8061
./start-server.sh --port 8062

# Nacos è‡ªåŠ¨è´Ÿè½½å‡è¡¡
```

### å‚ç›´æ‰©å±•

```yaml
# JVM å‚æ•°ä¼˜åŒ–
java -Xms2g -Xmx4g -XX:+UseG1GC ...
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](../quick-start/getting-started.md)
- [éƒ¨ç½²æŒ‡å—](../how-to-guides/deployment.md)
- [API å‚è€ƒ](../reference/api.md)
- [æ€§èƒ½ä¼˜åŒ–](../how-to-guides/performance-tuning.md)

---

**é—®é¢˜åé¦ˆ**: [åˆ›å»º Issue](https://github.com/thefirstwind/mcp-router-sse-parent/issues)
